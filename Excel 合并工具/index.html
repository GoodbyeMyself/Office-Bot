<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ExcelÊñá‰ª∂Ê±áÊÄªÂ∑•ÂÖ∑</title>

    <!-- Element Plus CSS -->
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css">

    <!-- Ëá™ÂÆö‰πâCSS -->
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div id="app">
        <!-- ‰∏ªÂÆπÂô® -->
        <el-container class="main-container">
            <!-- È°µÈù¢Â§¥ÈÉ® -->
            <el-header class="header">
                <h3>ExcelÊñá‰ª∂Ê±áÊÄªÂ∑•ÂÖ∑</h3>
            </el-header>

            <!-- ‰∏ªË¶ÅÂÜÖÂÆπÂå∫Âüü -->
            <el-main>
                <el-row :gutter="20" class="main-content">
                    <!-- Â∑¶‰æßÔºö‰∏ªË°®ÈÄâÊã© -->
                    <el-col :xs="24" :sm="24" :md="12" :lg="12">
                        <el-card class="panel-card">
                            <template #header>
                                <div class="card-header">
                                    <el-icon class="card-icon">üìã</el-icon>
                                    <span>‰∏ªË°®ÔºàÊ±áÊÄªË°®Ôºâ</span>
                                </div>
                            </template>

                            <el-upload class="upload-demo" :action="''" :http-request="() => {}"
                                :before-upload="beforeMainUpload" :on-success="handleMainUploadSuccess"
                                :on-error="handleUploadError" :show-file-list="false" accept=".xlsx,.xls" drag>
                                <div class="el-upload__text">
                                    Â∞Ü‰∏ªË°®Êñá‰ª∂ÊãñÂà∞Ê≠§Â§ÑÔºåÊàñ<em>ÁÇπÂáªÈÄâÊã©Êñá‰ª∂</em>
                                </div>
                                <template #tip>
                                    <div class="el-upload__tip">
                                        Âè™ËÉΩ‰∏ä‰º†xlsx/xlsÊñá‰ª∂
                                    </div>
                                </template>
                            </el-upload>

                            <!-- ‰∏ªË°®Êñá‰ª∂‰ø°ÊÅØ -->
                            <div v-if="mainFile" class="file-info-section">
                                <el-alert :title="`‰∏ªË°®Êñá‰ª∂Ôºö${mainFile.name}`" type="success" :closable="false" show-icon>
                                </el-alert>

                                <!-- ‰∏ªË°®Êï∞ÊçÆÈ¢ÑËßà -->
                                <div v-if="mainFile.data" class="preview-section">
                                    <h4>Êï∞ÊçÆÈ¢ÑËßà</h4>
                                    <el-table :data="mainFile.data.slice(1, 6)" style="width: 100%" size="small"
                                        max-height="250">
                                        <el-table-column v-for="(header, index) in mainFile.data[0]" :key="index"
                                            :prop="index.toString()" :label="header || `Âàó${index + 1}`"
                                            :formatter="(row) => row[index] || ''" show-overflow-tooltip>
                                        </el-table-column>
                                    </el-table>
                                    <div v-if="mainFile.data.length > 6" class="table-footer">
                                        <el-text type="info">... ËøòÊúâ {{ mainFile.data.length - 6 }} Ë°åÊï∞ÊçÆ</el-text>
                                    </div>
                                </div>
                            </div>
                        </el-card>
                    </el-col>

                    <!-- Âè≥‰æßÔºöÂæÖÂêàÂπ∂Êñá‰ª∂ÁÆ°ÁêÜ -->
                    <el-col :xs="24" :sm="24" :md="12" :lg="12">
                        <div class="right-panel-container">
                            <!-- ‰∏ä‰º†Âå∫Âüü -->
                            <div class="upload-section">
                                <h4 class="section-title">üìÅ ÂæÖÂêàÂπ∂Êñá‰ª∂ÂàóË°®</h4>
                                <el-upload class="upload-demo" :action="''" :http-request="() => {}"
                                    :before-upload="beforeMergeUpload" :on-success="handleMergeUploadSuccess"
                                    :on-error="handleUploadError" :on-remove="handleRemove" :on-exceed="handleExceed"
                                    accept=".xlsx,.xls" multiple drag>
                                    <div class="el-upload__text">
                                        Â∞ÜÂæÖÂêàÂπ∂Êñá‰ª∂ÊãñÂà∞Ê≠§Â§ÑÔºåÊàñ<em>ÁÇπÂáªÈÄâÊã©Êñá‰ª∂</em>
                                    </div>
                                    <template #tip>
                                        <div class="el-upload__tip">
                                            ÂèØ‰ª•ÈÄâÊã©Â§ö‰∏™Êñá‰ª∂ËøõË°åÂêàÂπ∂
                                        </div>
                                    </template>
                                </el-upload>
                            </div>

                            <!-- Êñá‰ª∂ÂàóË°®Âå∫Âüü -->
                            <el-card class="files-list-card">
                                <div v-if="mergeFiles.length === 0" class="empty-state">
                                    <el-empty description="ÊöÇÊú™Ê∑ªÂä†‰ªª‰ΩïÂæÖÂêàÂπ∂Êñá‰ª∂">
                                        <el-text type="info">ËØ∑Âú®‰∏äÊñπ‰∏ä‰º†ÂæÖÂêàÂπ∂ÁöÑExcelÊñá‰ª∂</el-text>
                                    </el-empty>
                                </div>

                                <div v-else class="merge-files-container">
                                    <div v-for="(file, index) in mergeFiles" :key="file.id" class="merge-file-card">
                                        <el-card shadow="hover">
                                            <template #header>
                                                <div class="file-card-header">
                                                    <el-text><el-icon>üìÑ</el-icon> {{ file.name }}</el-text>
                                                    <el-button type="danger" size="small" circle
                                                        @click="removeMergeFile(index)">
                                                        ‚úñ
                                                    </el-button>
                                                </div>
                                            </template>
                                            <!-- Êñá‰ª∂Êï∞ÊçÆÈ¢ÑËßà -->
                                            <div v-if="file.data" class="mini-preview">
                                                <el-collapse>
                                                    <el-collapse-item title="Êï∞ÊçÆÈ¢ÑËßà" name="preview">
                                                        <el-table :data="file.data.slice(1, 4)" size="small"
                                                            max-height="150">
                                                            <el-table-column v-for="(header, hIndex) in file.data[0]"
                                                                :key="hIndex" :prop="hIndex.toString()"
                                                                :label="header || `Âàó${hIndex + 1}`"
                                                                :formatter="(row) => row[hIndex] || ''"
                                                                show-overflow-tooltip>
                                                            </el-table-column>
                                                        </el-table>
                                                        <div v-if="file.data.length > 4" class="table-footer">
                                                            <el-text size="small" type="info">
                                                                ... ËøòÊúâ {{ file.data.length - 4 }} Ë°åÊï∞ÊçÆ
                                                            </el-text>
                                                        </div>
                                                    </el-collapse-item>
                                                </el-collapse>
                                            </div>
                                        </el-card>
                                    </div>
                                </div>
                            </el-card>
                        </div>
                    </el-col>
                </el-row>

                <!-- Êìç‰ΩúÊåâÈíÆÂå∫Âüü -->
                <el-row class="control-section">
                    <el-col :span="24" class="text-center">
                        <el-space size="large">
                            <el-button type="success" size="large" :disabled="!canMerge || loading" :loading="loading"
                                @click="performMerge">
                                üîÑ Áõ¥Êé•ÂêàÂπ∂Âà∞‰∏ªË°®
                            </el-button>
                        </el-space>

                        <!-- Âä†ËΩΩÁä∂ÊÄÅÊèêÁ§∫ -->
                        <div v-if="loading" class="loading-section">
                            <el-alert :title="loadingText" type="info" :closable="false" show-icon>
                                <el-icon class="is-loading">‚è≥</el-icon>
                            </el-alert>
                        </div>
                    </el-col>
                </el-row>

            </el-main>
        </el-container>
    </div>

    <!-- ÂºïÂÖ•JavaScriptÂ∫ì -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/element-plus/dist/index.full.js"></script>

    <!-- ÂºïÂÖ•Ëá™ÂÆö‰πâJavaScript -->
    <script src="script.js"></script>

    <script>
        // ÂàùÂßãÂåñÂ∫îÁî®
        const app = ExcelMergerApp;

        // ‰ΩøÁî®Element Plus
        app.use(ElementPlus);

        // ÊåÇËΩΩÂ∫îÁî®
        app.mount('#app');
    </script>
</body>

</html>